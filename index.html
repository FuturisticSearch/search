<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Future Search</title>
  <link rel="icon" href="favicon.png">

  <!-- OneSignal -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "db5ff4b3-1170-45f0-8b54-2afc9e626f44",
        notifyButton: { enable: true }
      });
    });
  </script>

  <!-- Fonts & Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin:0; padding:0;
      transition: background 0.3s ease;
      cursor:none;
    }
    body.dark-theme { background:#000; }
    body.light-theme { background:url('https://cdn.pixabay.com/photo/2020/01/21/20/30/earth-4780749_960_720.jpg') no-repeat center center fixed; background-size:cover; }

    h1 { color: lightblue; text-shadow:0 0 10px #00e0ff; text-align:center; cursor:pointer; margin:20px 0; }

    .theme-switch { position:fixed; top:15px; right:15px; padding:10px; font-size:22px; background:#00e0ff; border-radius:50%; border:none; cursor:pointer; color:#121212; z-index:1000; display:flex; justify-content:center; align-items:center; }

    .search-container { display:flex; justify-content:center; margin-bottom:20px; }

    .cursor { position:fixed; width:20px; height:20px; background:rgba(0,224,255,0.8); border-radius:50%; pointer-events:none; transform:translate(-50%,-50%); box-shadow:0 0 15px rgba(0,224,255,0.8),0 0 30px rgba(0,224,255,0.5); z-index:9999; }
    .cursor-trail { position:fixed; width:10px; height:10px; background:rgba(0,224,255,0.4); border-radius:50%; pointer-events:none; z-index:9998; animation:fade 0.6s ease-out forwards; }
    @keyframes fade { 0%{opacity:1;transform:scale(1);} 100%{opacity:0;transform:scale(2);} }

    @media (max-width:600px){
      body { cursor:auto; }
      .cursor,.cursor-trail { display:none; }
    }
  </style>
</head>
<body class="dark-theme">

  <h1 onclick="window.location.href='https://futuresearch.netlify.app'">Future Search</h1>
  <button class="theme-switch" id="themeToggleBtn">üåô</button>

  <div class="search-container">
    <div class="gcse-searchbox"></div>
  </div>
  <div class="gcse-searchresults-only" id="searchResults"></div>

  <div class="cursor" id="cursor"></div>

  <script>
    // Cursor animation
    document.addEventListener('mousemove', e => {
      const c = document.getElementById('cursor');
      c.style.top = e.clientY + 'px';
      c.style.left = e.clientX + 'px';
      const t = document.createElement('div');
      t.className = 'cursor-trail';
      t.style.top = e.clientY + 'px';
      t.style.left = e.clientX + 'px';
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 600);
    });

    // Dynamic CSE loader
    const CSE_IDS = {
      dark: "12d541be710094451",   // dark-themed CSE
      light: "a1ef681a86c0942ad"   // light-themed CSE
    };
    let currentQuery = "";

    function loadCSE(cx, query="") {
      // Remove previous CSE scripts
      const existing = document.querySelectorAll('script[data-cse]');
      existing.forEach(s => s.remove());

      const s = document.createElement('script');
      s.src = `https://cse.google.com/cse.js?cx=${cx}`;
      s.async = true;
      s.setAttribute('data-cse','true');
      s.onload = () => {
        if(query){
          const input = document.querySelector("input.gsc-input");
          const button = document.querySelector("button.gsc-search-button");
          if(input && button){
            input.value = query;
            button.click();
          }
        }
      };
      document.head.appendChild(s);
    }

    // Theme toggle
    const themeBtn = document.getElementById("themeToggleBtn");
    function toggleTheme(){
      const body = document.body;
      if(body.classList.contains("dark-theme")){
        body.classList.remove("dark-theme"); body.classList.add("light-theme");
        themeBtn.innerText="‚òÄÔ∏è";
        localStorage.setItem("theme","light-theme");
        loadCSE(CSE_IDS.light, currentQuery);
      } else {
        body.classList.remove("light-theme"); body.classList.add("dark-theme");
        themeBtn.innerText="üåô";
        localStorage.setItem("theme","dark-theme");
        loadCSE(CSE_IDS.dark, currentQuery);
      }
    }
    themeBtn.addEventListener("click", toggleTheme);

    // On load: set theme & load proper CSE
    document.addEventListener("DOMContentLoaded", () => {
      const savedTheme = localStorage.getItem("theme") || "dark-theme";
      if(savedTheme === "light-theme"){
        document.body.classList.add("light-theme");
        themeBtn.innerText = "‚òÄÔ∏è";
        loadCSE(CSE_IDS.light);
      } else {
        document.body.classList.add("dark-theme");
        themeBtn.innerText = "üåô";
        loadCSE(CSE_IDS.dark);
      }

      // Pre-fill query from URL
      const urlQuery = new URLSearchParams(window.location.search).get("q");
      if(urlQuery) currentQuery = urlQuery;
    });
  </script>

</body>
</html>
