<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Future Search — Admin Push Panel</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --cyan:#00e0ff;
      --cyan-d:#00b8d4;
      --bg-dark:#000;
      --bg-pane:rgba(0,0,0,.6);
      --text:#e0e0e0;
      --shadow:0 0 15px rgba(0,255,255,.5);
    }
    *{box-sizing:border-box}
    body{
      font-family:'Roboto',sans-serif;
      margin:0; padding:0; min-height:100vh;
      color:var(--text);
      background:#000 url('https://cdn.pixabay.com/photo/2020/01/21/20/30/earth-4780749_960_720.jpg') no-repeat center/cover fixed;
    }
    .wrap{
      max-width:860px; margin:32px auto; padding:16px;
    }
    .title{
      text-align:center; margin:8px 0 20px;
      color:lightblue; text-shadow:0 0 10px var(--cyan);
      cursor:pointer; display:inline-block; width:100%;
      -webkit-tap-highlight-color: transparent;
      transition:transform .2s ease;
    }
    .title:hover{ transform:scale(1.05) }

    .card{
      background:var(--bg-pane);
      border:1px solid var(--cyan);
      border-radius:12px;
      box-shadow:var(--shadow);
      padding:16px;
      backdrop-filter: blur(2px);
    }

    .grid{
      display:grid; gap:14px;
      grid-template-columns: 1fr 1fr;
    }
    .grid-1{ grid-template-columns: 1fr; }
    .grid-3{ grid-template-columns: 1fr 1fr 1fr; }
    @media(max-width:760px){
      .grid,.grid-3{ grid-template-columns:1fr; }
    }

    label{
      font-size:14px; opacity:.9; margin-bottom:6px; display:block;
    }
    input, textarea, select{
      width:100%; padding:12px 14px; font-size:16px;
      border-radius:10px; outline:none;
      border:2px solid var(--cyan);
      background:transparent; color:#fff;
      box-shadow:0 0 10px rgba(0,255,255,.25) inset;
      transition:border-color .2s ease, box-shadow .2s ease;
    }
    input:focus, textarea:focus{
      border-color:var(--cyan-d);
      box-shadow:0 0 15px rgba(0,184,212,.5) inset;
    }
    textarea{ min-height:110px; resize:vertical; }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .btn{
      background:var(--cyan); color:#121212; border:none;
      padding:12px 16px; border-radius:10px; cursor:pointer;
      font-weight:700; box-shadow:var(--shadow);
      transition:background .2s ease, box-shadow .2s ease, transform .05s ease;
    }
    .btn:hover{ background:var(--cyan-d); box-shadow:0 0 20px rgba(0,184,212,.8); }
    .btn:active{ transform:scale(.98); }
    .btn.secondary{ background:#202124; color:#fff; }
    .note{ font-size:13px; opacity:.85; }

    .divider{ height:1px; background:rgba(0,224,255,.35); margin:12px 0; border-radius:999px; }

    .status{
      margin-top:14px; padding:12px; border-radius:10px;
      background:rgba(0,0,0,.5); border:1px solid rgba(0,224,255,.35);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      white-space:pre-wrap; word-break:break-word;
      max-height:240px; overflow:auto;
    }
    .pill{
      display:inline-block; padding:6px 10px; border-radius:999px;
      border:1px solid var(--cyan); background:rgba(0,224,255,.08);
      font-size:12px; margin-left:6px;
    }
    .danger{ border-color:#ff6b6b; color:#ffb3b3; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title" onclick="location.href='https://futuresearch.netlify.app/app'">Future Search — Push Admin</h1>

    <div class="card" aria-label="Send Notification Panel">
      <div class="row" style="justify-content:space-between;">
        <div class="note">
          Sends to: <strong>All subscribed users</strong>
          <span class="pill">Web Push</span>
        </div>
        <div class="note">OneSignal App ID: <code id="appIdShow">db5ff4b3-1170-45f0-8b54-2afc9e626f44</code></div>
      </div>

      <div class="divider"></div>

      <!-- Credentials -->
      <div class="grid">
        <div>
          <label>OneSignal REST API Key <span class="pill danger">required / secret</span></label>
          <input id="apiKey" type="text" placeholder="Paste your OneSignal REST API Key"/>
          <div class="note">We only use it in your browser for this send; it is not saved server-side.</div>
        </div>
        <div>
          <label>OneSignal App ID</label>
          <input id="appId" type="text" value="db5ff4b3-1170-45f0-8b54-2afc9e626f44"/>
          <div class="note">Change only if you use a different OneSignal app.</div>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Message -->
      <div class="grid">
        <div>
          <label>Title</label>
          <input id="title" type="text" placeholder="e.g., Future Search update"/>
        </div>
        <div>
          <label>Message</label>
          <input id="message" type="text" placeholder="e.g., New feature is live — try it now!"/>
        </div>
      </div>

      <div class="grid">
        <div>
          <label>Launch URL (opens when clicked)</label>
          <input id="launchUrl" type="url" placeholder="https://futuresearch.netlify.app"/>
        </div>
        <div>
          <label>Icon URL (optional)</label>
          <input id="iconUrl" type="url" placeholder="https://futuresearch.netlify.app/favicon.png"/>
        </div>
      </div>

      <div class="grid">
        <div>
          <label>Large Image (optional)</label>
          <input id="imageUrl" type="url" placeholder="https://.../banner.png"/>
          <div class="note">Shown on some browsers (Chrome Windows/Android).</div>
        </div>
        <div>
          <label>Buttons JSON (optional)</label>
          <textarea id="buttonsJson" placeholder='[{"id":"open","text":"Open","url":"https://futuresearch.netlify.app"}]'></textarea>
          <div class="note">Up to 2 buttons. Leave empty to skip.</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="row">
        <button class="btn" onclick="sendPush()">Send Notification</button>
        <button class="btn secondary" onclick="prefillDemo()">Prefill Demo</button>
      </div>

      <div id="status" class="status" aria-live="polite"></div>
    </div>

    <p class="note" style="margin-top:10px;">
      ⚠️ If a user doesn’t receive pushes: their browser might not support Web Push, or they didn’t accept permission, or the service worker isn’t installed. Chrome/Edge usually work great.
    </p>
  </div>

  <script>
    function out(msg, append=true){
      const s = document.getElementById('status');
      if(!append) s.textContent = '';
      s.textContent += (s.textContent ? '\n' : '') + msg;
    }

    // ---- LOCAL STORAGE FOR API KEY ----
    const apiKeyInput = document.getElementById('apiKey');
    window.addEventListener('DOMContentLoaded', () => {
      const savedKey = localStorage.getItem('apiKey');
      if (savedKey) apiKeyInput.value = savedKey;
    });
    apiKeyInput.addEventListener('input', () => {
      localStorage.setItem('apiKey', apiKeyInput.value);
    });

    // ---- DEMO PREFILL ----
    function prefillDemo(){
      const savedApiKey = apiKeyInput.value; // Preserve saved API key
      document.getElementById('title').value = 'Hello from Future Search';
      document.getElementById('message').value = 'Quick update — thanks for subscribing!';
      document.getElementById('launchUrl').value = 'https://futuresearch.netlify.app';
      document.getElementById('iconUrl').value = 'https://futuresearch.netlify.app/favicon.png';
      document.getElementById('imageUrl').value = '';
      document.getElementById('buttonsJson').value =
        '[{"id":"open","text":"Open","url":"https://futuresearch.netlify.app"}]';
      apiKeyInput.value = savedApiKey; // restore API key
      out('Demo values filled.', false);
    }

    // ---- SEND PUSH ----
    async function sendPush(){
      const apiKey   = apiKeyInput.value.trim();
      const appId    = document.getElementById('appId').value.trim();
      const title    = document.getElementById('title').value.trim();
      const message  = document.getElementById('message').value.trim();
      const launchUrl= document.getElementById('launchUrl').value.trim();
      const iconUrl  = document.getElementById('iconUrl').value.trim();
      const imageUrl = document.getElementById('imageUrl').value.trim();
      const buttons  = document.getElementById('buttonsJson').value.trim();

      document.getElementById('status').textContent = '';

      if(!apiKey){ out('❌ REST API Key is required.'); return; }
      if(!appId){ out('❌ App ID is required.'); return; }
      if(!title){ out('❌ Title is required.'); return; }
      if(!message){ out('❌ Message is required.'); return; }

      const body = {
        app_id: appId,
        included_segments: ['All'],
        headings: { en: title },
        contents: { en: message }
      };
      if(launchUrl) body.url = launchUrl;
      if(iconUrl)   body.chrome_web_icon = iconUrl;
      if(imageUrl)  body.chrome_web_image = imageUrl;
      if(buttons){
        try{
          const parsed = JSON.parse(buttons);
          if(Array.isArray(parsed)) body.web_buttons = parsed.slice(0,2);
        }catch(e){
          out('⚠️ Buttons JSON is invalid. Ignoring buttons.');
        }
      }

      try{
        out('⏳ Sending...');
        const res = await fetch('https://api.onesignal.com/notifications', {
          method: 'POST',
          headers: {
            'Authorization': 'Basic ' + apiKey,
            'Content-Type': 'application/json; charset=utf-8'
          },
          body: JSON.stringify(body)
        });

        const text = await res.text();
        try{
          const json = JSON.parse(text);
          if(res.ok){
            out('✅ Sent! Notification ID: ' + (json.id || 'unknown'));
          }else{
            out('❌ Error ('+res.status+'): ' + (json.errors || text));
          }
        }catch{
          if(res.ok){
            out('✅ Sent! (non-JSON response)\n' + text);
          }else{
            out('❌ Error ('+res.status+'):\n' + text);
          }
        }
      }catch(err){
        out('💥 Network/Fetch error: ' + err.message);
      }
    }
  </script>
</body>
</html>
